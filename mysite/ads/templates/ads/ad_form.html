{% extends 'base_bootstrap.html' %}

{% block content %}
<h1>{% if form.instance.pk %}Edit Ad{% else %}Create Ad{% endif %}</h1>

<form method="post" enctype="multipart/form-data" id="upload_form">
    {% csrf_token %}
    <div style="margin-bottom: 15px;">
        <label for="{{ form.title.id_for_label }}">Title:</label>
        {{ form.title }}
    </div>
    <div style="margin-bottom: 15px;">
        <label for="{{ form.price.id_for_label }}">Price:</label>
        {{ form.price }}
    </div>
    <div style="margin-bottom: 15px;">
        <label for="{{ form.text.id_for_label }}">Text:</label>
        {{ form.text }}
    </div>
    <div style="margin-bottom: 15px;">
        <label for="{{ form.tags.id_for_label }}">Tags:</label>
        {{ form.tags }}
        <div style="color: #666; font-size: 0.8em; margin-top: 5px;">Enter tags separated by commas</div>
    </div>
    <div style="margin-bottom: 15px;">
        <label for="{{ form.picture.id_for_label }}">Picture to Upload:</label>
        {{ form.picture }}
        <span id="file_size_message" style="display: none; margin-left: 10px; padding: 5px 10px; border-radius: 3px; font-size: 0.9em;"></span>
        <div style="color: #666; font-size: 0.8em; margin-top: 5px;">üìÅ File size limit: 2 MB maximum</div>
    </div>
    <input type="submit" value="Submit">
</form>

<script type="text/javascript">
    // File size validation - this script checks uploaded file size
    window.onload = function() {
        console.log('File size validation script loaded');
        
        var form = document.getElementById('upload_form');
        var fileInput = document.querySelector('input[type="file"]');
        var messageSpan = document.getElementById('file_size_message');
        
        if (fileInput) {
            console.log('File input found:', fileInput);
            
            // Check file size when file is selected
            fileInput.onchange = function() {
                console.log('File selected');
                if (this.files.length > 0) {
                    var file = this.files[0];
                    var fileSize = file.size;
                    var maxSize = 2 * 1024 * 1024; // 2MB
                    var fileSizeMB = (fileSize / (1024 * 1024)).toFixed(2);
                    
                    console.log('File size:', fileSize, 'bytes, Max size:', maxSize);
                    
                    if (fileSize > maxSize) {
                        messageSpan.innerHTML = '‚ùå ' + fileSizeMB + ' MB (too large)';
                        messageSpan.style.display = 'inline';
                        messageSpan.style.color = 'red';
                        messageSpan.style.backgroundColor = '#ffe6e6';
                        messageSpan.style.border = '1px solid #ff9999';
                        this.value = '';
                        console.log('File rejected - too large');
                    } else {
                        messageSpan.innerHTML = '‚úÖ ' + fileSizeMB + ' MB (OK)';
                        messageSpan.style.display = 'inline';
                        messageSpan.style.color = 'green';
                        messageSpan.style.backgroundColor = '#e6ffe6';
                        messageSpan.style.border = '1px solid #99ff99';
                        console.log('File accepted - size OK');
                    }
                } else {
                    messageSpan.style.display = 'none';
                }
            };
        }
        
        // Check file size before form submission
        if (form) {
            form.onsubmit = function(e) {
                console.log('Form submission check');
                var fileInput = document.querySelector('input[type="file"]');
                if (fileInput && fileInput.files.length > 0) {
                    var file = fileInput.files[0];
                    var fileSize = file.size;
                    var maxSize = 2 * 1024 * 1024; // 2MB
                    
                    console.log('Submitting file size:', fileSize, 'bytes');
                    
                    if (fileSize > maxSize) {
                        e.preventDefault();
                        return false;
                    }
                }
                return true;
            };
        }
    };
</script>
{% endblock %}
