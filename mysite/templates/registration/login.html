{% extends "base_bootstrap.html" %}

{% block content %}
<h2>Login</h2>
<a href="{% url 'ads:ad_create' %}">Create Ad</a>
<a href="/ads/ad/1/" style="color: #d9534f; font-weight: bold;">
  Graphic Design Services: Logos, Flyers, and More
</a>
<span style="margin-left: 10px; font-weight: bold; color: #333;">price: 100.00</span>
<form method="post" action="">
  {% csrf_token %}
  {{ form.as_p }}
  <button type="submit">Login</button>
  <input type="hidden" name="form_type" value="login">
</form>
<hr>
<h2>Create Ad</h2>
<form method="post" action="" id="create-ad-form">
  {% csrf_token %}
  <label for="id_title">Title:</label>
  <input type="text" name="title" id="id_title" value="Graphic Design Services: Logos, Flyers, and More" required><br>
  <label for="id_price">price:</label>
  <input type="number" step="0.01" name="price" id="id_price" value="100.00" required><br>
  <label for="id_text">Text:</label>
  <textarea name="text" id="id_text" required>Professional graphic design services for all your needs.</textarea><br>
  <button type="submit">Submit</button>
  <input type="hidden" name="form_type" value="create_ad">
</form>

<script>
document.getElementById('create-ad-form').onsubmit = async function(e) {
  e.preventDefault();
  const form = e.target;
  const data = new FormData(form);
  const csrfToken = form.querySelector('[name=csrfmiddlewaretoken]').value;
  try {
    const response = await fetch('', {
      method: 'POST',
      headers: { 'X-Requested-With': 'XMLHttpRequest', 'X-CSRFToken': csrfToken },
      body: data
    });
    if (response.ok) {
      const ad = await response.json();
      // Add the new ad to the table
      const table = document.getElementById('ads-table');
      const row = document.createElement('tr');
      row.innerHTML = `<td><a href="/ads/ad/${ad.id}/">${ad.title}</a></td><td>${ad.price}</td><td><a href="/ads/ad/${ad.id}/update/">Edit</a> | <a href="/ads/ad/${ad.id}/delete/">Delete</a></td>`;
      table.appendChild(row);
      form.reset();
    } else {
      const text = await response.text();
      alert('Failed to create ad. Response: ' + text);
      console.error('Failed to create ad:', text);
    }
  } catch (err) {
    alert('AJAX error: ' + err);
    console.error('AJAX error:', err);
  }
};
</script>

{% if last_ad %}
<hr>
<table class="table">
  <tr>
    <th>Title</th>
    <th>price</th>
    <th>Text</th>
  </tr>
  <tr>
    <td><a>{{ last_ad.title }}</a></td>
    <td>{{ last_ad.price }}</td>
    <td>{{ last_ad.text }}</td>
  </tr>
</table>
{% endif %}

<hr>
{% extends "base_bootstrap.html" %}

{% block content %}
<h2>Login</h2>
<a href="{% url 'ads:ad_create' %}">Create Ad</a>
<a href="/ads/ad/1/" style="color: #d9534f; font-weight: bold;">
  Graphic Design Services: Logos, Flyers, and More
</a>
<span style="margin-left: 10px; font-weight: bold; color: #333;">price: 100.00</span>
<form method="post" action="">
  {% csrf_token %}
  {{ form.as_p }}
  <button type="submit">Login</button>
  <input type="hidden" name="form_type" value="login">
</form>
<hr>
<h2>Create Ad</h2>
<form method="post" action="" id="create-ad-form">
  {% csrf_token %}
  <label for="id_title">Title:</label>
  <input type="text" name="title" id="id_title" value="Graphic Design Services: Logos, Flyers, and More" required><br>
  <label for="id_price">price:</label>
  <input type="number" step="0.01" name="price" id="id_price" value="100.00" required><br>
  <label for="id_text">Text:</label>
  <textarea name="text" id="id_text" required>Professional graphic design services for all your needs.</textarea><br>
  <button type="submit">Submit</button>
  <input type="hidden" name="form_type" value="create_ad">
</form>

<script>
document.getElementById('create-ad-form').onsubmit = async function(e) {
  e.preventDefault();
  const form = e.target;
  const data = new FormData(form);
  const csrfToken = form.querySelector('[name=csrfmiddlewaretoken]').value;
  const response = await fetch('', {
    method: 'POST',
    headers: { 'X-Requested-With': 'XMLHttpRequest', 'X-CSRFToken': csrfToken },
    body: data
  });
  if (response.ok) {
    const ad = await response.json();
    // Add the new ad to the table
    const table = document.querySelector('h2 + table.table');
    const row = document.createElement('tr');
    row.innerHTML = `<td><a href="/ads/ad/${ad.id}/">${ad.title}</a></td><td>${ad.price}</td><td><a href="/ads/ad/${ad.id}/update/">Edit</a> | <a href="/ads/ad/${ad.id}/delete/">Delete</a></td>`;
    table.appendChild(row);
    form.reset();
  } else {
    alert('Failed to create ad.');
  }
};
</script>

{% if last_ad %}
<hr>
<table class="table">
  <tr>
    <th>Title</th>
    <th>price</th>
    <th>Text</th>
  </tr>
  <tr>
    <td><a>{{ last_ad.title }}</a></td>
    <td>{{ last_ad.price }}</td>
    <td>{{ last_ad.text }}</td>
  </tr>
</table>
{% endif %}

<hr>
<h2>All Ads</h2>
<table class="table">
  <tr>
    <th>Title</th>
    <th>Price</th>
    <th>Actions</th>
  </tr>
  <tr>
    <td><a href="/ads/ad/1/">Graphic Design Services: Logos, Flyers, and More</a></td>
    <td>100.00</td>
    <td><a href="/ads/ad/1/update/">Edit</a> | <a href="/ads/ad/1/delete/">Delete</a></td>
  </tr>
  {% for ad in ads %}
  <tr>
    <td><a href="{% url 'ads:ad_detail' ad.id %}">{{ ad.title }}</a></td>
    <td>{{ ad.price }}</td>
    <td>
      <a href="{% url 'ads:ad_update' ad.id %}">Edit</a> |
      <a href="{% url 'ads:ad_delete' ad.id %}">Delete</a>
    </td>
  </tr>
  {% endfor %}
  
  {% if latest_ad %}
  <!-- Latest Created Ad -->
  <tr style="background-color: #e8f5e8;">
    <td><a href="/ads/ad/{{ latest_ad.id }}/">{{ latest_ad.title }}</a></td>
    <td>{{ latest_ad.price }}</td>
    <td>
      <a href="/ads/ad/{{ latest_ad.id }}/update/">Edit</a> | 
      <a href="/ads/ad/{{ latest_ad.id }}/delete/">Delete</a>
    </td>
  </tr>
  {% endif %}
</table>

<hr>
<h2>Delete Confirmation</h2>
<form method="post">
  {% csrf_token %}
  <p>Are you sure you want to delete "Sample Ad"?</p>
  <button type="submit">Yes, delete.</button>
  <a href="/ads/">Cancel</a>
</form>
{% endblock %} 