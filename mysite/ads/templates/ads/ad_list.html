{% extends "base_bootstrap.html" %}

{% block content %}
  <h1>Ads List</h1>
  {% if ad_list %}
  <table class="table table-striped">
    <thead>
      <tr>
        <th>Title</th>
        <th>Price</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="ads-table-body">
      {% for ad in ad_list %}
      <tr>
        <td><a href="{% url 'ads:ad_detail' ad.id %}">{{ ad.title }}</a></td>
        <td>{{ ad.price }}</td>
        <td>
          {% if user.is_authenticated and user.id == ad.owner.id %}
            <a href="{% url 'ads:ad_update' ad.id %}">Edit</a> | 
            <a href="{% url 'ads:ad_delete' ad.id %}">Delete</a>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <p>There are no ads in the database</p>
  {% endif %}
  <p>
    {% if user.is_authenticated %}
    <a href="{% url 'ads:ad_create' %}">Create Ad</a> |
    {% endif %}
    <a href="{% url 'ads:all' %}">View all</a>
  </p>

  <script>
    // Function to refresh the ads table
    function refreshAdsTable() {
      fetch('/ads/ad/list/ajax/')
        .then(response => response.text())
        .then(html => {
          document.getElementById('ads-table-body').innerHTML = html;
        })
        .catch(error => console.error('Error refreshing ads:', error));
    }

    // Refresh table every 2 seconds
    setInterval(refreshAdsTable, 2000);

    // Also refresh when page becomes visible (user switches back to tab)
    document.addEventListener('visibilitychange', function() {
      if (!document.hidden) {
        refreshAdsTable();
      }
    });
  </script>
{% endblock %} 